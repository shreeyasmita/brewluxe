<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BREWLUXE - Premium Coffee Shop | Where Every Sip Tells a Story</title>
    <meta name="description" content="Experience luxury coffee at BREWLUXE. Premium drinks, specialty beans, loyalty rewards, and exceptional service.">
    <meta name="keywords" content="coffee, premium coffee, espresso, cappuccino, coffee shop, loyalty rewards">
    <meta property="og:title" content="BREWLUXE - Premium Coffee Experience">
    <meta property="og:description" content="Discover luxury coffee at BREWLUXE. Premium drinks, specialty beans, and loyalty rewards.">
    <meta property="og:type" content="website">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --gold: #c9a96e;
            --dark: #1a1a1a;
            --darker: #0f0f0f;
            --light: #f5f5f5;
            --glass: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
            color: var(--light);
            overflow-x: hidden;
        }

        nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(201, 169, 110, 0.1);
            transition: all 0.3s;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, #c9a96e 0%, #8b7355 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            box-shadow: 0 0 20px rgba(201, 169, 110, 0.5);
            animation: logoPulse 2s infinite;
        }

        @keyframes logoPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(201, 169, 110, 0.5); }
            50% { box-shadow: 0 0 30px rgba(201, 169, 110, 0.8); }
        }

        .brand-name {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--gold) 0%, white 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
            align-items: center;
        }

        .nav-links a {
            color: var(--light);
            text-decoration: none;
            position: relative;
            transition: color 0.3s;
            font-weight: 500;
        }

        .nav-links a:hover {
            color: var(--gold);
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--gold);
            transition: width 0.3s;
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        .nav-icons {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .icon-btn {
            background: none;
            border: none;
            color: var(--light);
            font-size: 24px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
        }

        .icon-btn:hover {
            color: var(--gold);
            transform: scale(1.1);
        }

        .badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .hero {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            overflow: hidden;
            padding-top: 80px;
        }

        .hero-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.3;
            z-index: 0;
        }

        .hero::before {
            content: '';
            position: absolute;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(201, 169, 110, 0.2) 0%, transparent 70%);
            border-radius: 50%;
            animation: float 6s infinite ease-in-out;
            z-index: 1;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(50px, -50px) scale(1.1); }
        }

        .hero-content {
            position: relative;
            z-index: 2;
        }

        .hero h1 {
            font-family: 'Playfair Display', serif;
            font-size: 5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--gold) 0%, white 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: fadeInUp 1s;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hero p {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--gold) 0%, #8b7355 100%);
            color: white;
            padding: 1rem 3rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
        }

        section {
            padding: 5rem 5%;
            position: relative;
        }

        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            text-align: center;
            margin-bottom: 3rem;
            background: linear-gradient(135deg, var(--gold) 0%, white 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 3rem 0;
        }

        .gallery-item {
            position: relative;
            overflow: hidden;
            border-radius: 20px;
            height: 300px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .gallery-item:hover {
            transform: scale(1.05);
        }

        .gallery-item img,
        .gallery-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding: 1.5rem;
            transform: translateY(100%);
            transition: transform 0.3s;
        }

        .gallery-item:hover .gallery-overlay {
            transform: translateY(0);
        }

        .gallery-overlay h3 {
            color: var(--gold);
            margin-bottom: 0.5rem;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .menu-card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(201, 169, 110, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .menu-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(201, 169, 110, 0.3);
        }

        .menu-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 15px;
            margin-bottom: 1rem;
        }

        .menu-card h3 {
            color: var(--gold);
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
        }

        .menu-card p {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 1rem;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .price {
            font-size: 1.5rem;
            color: var(--gold);
            font-weight: 600;
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
        }

        .icon-btn-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid var(--gold);
            background: rgba(201, 169, 110, 0.1);
            color: var(--gold);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .icon-btn-small:hover {
            background: var(--gold);
            color: white;
            transform: scale(1.1);
        }

        .icon-btn-small.active {
            background: #e74c3c;
            border-color: #e74c3c;
            color: white;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .product-card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 1.5rem;
            border: 1px solid rgba(201, 169, 110, 0.2);
            transition: transform 0.3s;
        }

        .product-card:hover {
            transform: translateY(-10px);
        }

        .product-card img {
            width: 100%;
            height: 220px;
            object-fit: cover;
            border-radius: 15px;
        }

        .rating {
            color: #f39c12;
            margin: 0.5rem 0;
        }

        .video-section {
            max-width: 1200px;
            margin: 3rem auto;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(201, 169, 110, 0.2);
        }

        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 15px;
        }

        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .reviews-container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .review-slide {
            display: none;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 3rem;
            border: 1px solid rgba(201, 169, 110, 0.2);
            text-align: center;
        }

        .review-slide.active {
            display: block;
            animation: slideIn 0.5s;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .review-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            border: 3px solid var(--gold);
        }

        .review-stars {
            color: #f39c12;
            font-size: 1.5rem;
            margin: 1rem 0;
        }

        .carousel-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        .carousel-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--gold);
            background: rgba(201, 169, 110, 0.1);
            color: var(--gold);
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
        }

        .carousel-btn:hover {
            background: var(--gold);
            color: white;
        }

        .chat-widget {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .chat-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--gold) 0%, #8b7355 100%);
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(201, 169, 110, 0.5);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .chat-window {
            display: none;
            position: absolute;
            bottom: 80px;
            right: 0;
            width: 350px;
            height: 500px;
            background: rgba(15, 15, 15, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid var(--gold);
            flex-direction: column;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .chat-window.active {
            display: flex;
        }

        .chat-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--gold) 0%, #8b7355 100%);
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            padding: 0.8rem;
            border-radius: 15px;
            max-width: 80%;
            animation: messageSlide 0.3s;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.bot {
            background: rgba(201, 169, 110, 0.2);
            align-self: flex-start;
        }

        .message.user {
            background: var(--gold);
            align-self: flex-end;
            color: white;
        }

        .chat-input-container {
            padding: 1rem;
            border-top: 1px solid rgba(201, 169, 110, 0.2);
            display: flex;
            gap: 0.5rem;
        }

        .chat-input {
            flex: 1;
            padding: 0.8rem;
            border-radius: 25px;
            border: 1px solid var(--gold);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            outline: none;
        }

        .send-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gold);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .send-btn:hover {
            transform: scale(1.1);
        }

        .loyalty-card {
            background: linear-gradient(135deg, rgba(201, 169, 110, 0.2) 0%, rgba(139, 115, 85, 0.2) 100%);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 3rem;
            border: 1px solid var(--gold);
            text-align: center;
            max-width: 600px;
            margin: 2rem auto;
        }

        .points-display {
            font-size: 3rem;
            color: var(--gold);
            font-weight: 700;
            margin: 1rem 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold) 0%, #f39c12 100%);
            transition: width 0.5s;
        }

        .contact-form {
            max-width: 600px;
            margin: 0 auto;
            background: var(--glass);
            backdrop-filter: blur(10px);
            padding: 3rem;
            border-radius: 20px;
            border: 1px solid rgba(201, 169, 110, 0.2);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--gold);
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 1rem;
            border-radius: 10px;
            border: 1px solid rgba(201, 169, 110, 0.3);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            outline: none;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            border-color: var(--gold);
            box-shadow: 0 0 15px rgba(201, 169, 110, 0.3);
        }

        footer {
            background: var(--darker);
            padding: 3rem 5%;
            text-align: center;
            border-top: 1px solid rgba(201, 169, 110, 0.2);
        }

        .social-icons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
        }

        .social-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--gold);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gold);
            text-decoration: none;
            font-size: 20px;
            transition: all 0.3s;
        }

        .social-icon:hover {
            background: var(--gold);
            color: white;
            transform: scale(1.1);
        }

        .toast {
            position: fixed;
            top: 100px;
            right: 30px;
            background: rgba(15, 15, 15, 0.98);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-radius: 10px;
            border: 1px solid var(--gold);
            display: flex;
            align-items: center;
            gap: 1rem;
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 2000;
        }

        .toast.show {
            transform: translateX(0);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--dark);
            border-radius: 20px;
            padding: 3rem;
            max-width: 600px;
            width: 90%;
            border: 1px solid var(--gold);
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--gold);
            font-size: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .close-btn:hover {
            transform: scale(1.2);
        }

        .newsletter-form {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .newsletter-form input {
            flex: 1;
            padding: 1rem;
            border-radius: 10px;
            border: 1px solid var(--gold);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            outline: none;
        }

        .cart-modal-content {
            max-height: 50vh;
            overflow-y: auto;
        }

        .cart-item {
            background: var(--glass);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-item-info h4 {
            color: var(--gold);
            margin-bottom: 0.5rem;
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .qty-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--gold);
            border: none;
            color: white;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-total {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 2px solid var(--gold);
            font-size: 1.5rem;
            color: var(--gold);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .stat-card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            border: 1px solid rgba(201, 169, 110, 0.2);
        }

        .stat-number {
            font-size: 3rem;
            color: var(--gold);
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox img,
        .lightbox video {
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
        }

        .lightbox-close {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: var(--gold);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
        }

        .order-type-btn {
            flex: 1;
            padding: 1rem;
            border: 2px solid var(--gold);
            background: rgba(201, 169, 110, 0.1);
            color: var(--gold);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .order-type-btn.active {
            background: var(--gold);
            color: white;
        }

        .order-type-btn:hover {
            transform: translateY(-2px);
        }

        .form-error {
            color: #e74c3c;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: none;
        }

        .form-group.error input,
        .form-group.error textarea,
        .form-group.error select {
            border-color: #e74c3c !important;
            background: rgba(231, 76, 60, 0.1) !important;
        }

        .form-group.error .form-error {
            display: block;
        }

        /* Promo banner styles (new) */
        .promo-banner {
            position: fixed;
            top: 72px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1200;
            width: calc(100% - 6%);
            max-width: 1100px;
            display: flex;
            justify-content: center;
            pointer-events: auto;
        }

        .promo-content {
            background: linear-gradient(90deg, rgba(201,169,110,0.14), rgba(139,115,85,0.08));
            border: 1px solid rgba(201,169,110,0.18);
            padding: 0.6rem 1rem;
            border-radius: 12px;
            display: flex;
            gap: 1rem;
            align-items: center;
            width: 100%;
            justify-content: space-between;
            box-shadow: 0 6px 24px rgba(0,0,0,0.25);
        }

        .promo-text {
            color: var(--light);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .close-promo {
            background: none;
            border: none;
            color: var(--light);
            font-size: 20px;
            cursor: pointer;
        }

        @media (max-width: 900px) {
            .promo-banner { top: 68px; left: 50%; transform: translateX(-50%); width: calc(100% - 8%); }
            .promo-content { padding: 0.6rem 0.8rem; gap: .6rem; }
            .promo-text { font-size: 0.9rem; }
            .promo-content .btn-primary { padding: 0.5rem 1rem; font-size: 0.9rem; }
        }

        /* NEW FEATURES STYLES */
        
        /* Theme Toggle */
        .theme-toggle {
            background: rgba(201, 169, 110, 0.2);
            border: 1px solid var(--gold);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 20px;
        }

        .theme-toggle:hover {
            background: var(--gold);
            color: white;
        }

        body.light-mode {
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            color: #1a1a1a;
        }

        body.light-mode .nav {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        body.light-mode section {
            background: rgba(255, 255, 255, 0.9);
        }

        /* Barista Cards */
        .barista-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .barista-card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            border: 1px solid rgba(201, 169, 110, 0.2);
            transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
            cursor: pointer;
            position: relative;
            min-height: 380px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .barista-card:hover {
            transform: translateY(-15px);
            box-shadow: 0 15px 40px rgba(201, 169, 110, 0.4);
            border-color: rgba(201, 169, 110, 0.5);
        }

        .barista-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            border: 3px solid var(--gold);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            background: rgba(201, 169, 110, 0.1);
            transition: transform 0.3s;
        }

        .barista-card:hover .barista-avatar {
            transform: scale(1.1);
        }

        .barista-card h3 {
            color: var(--gold);
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }

        .barista-title {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .barista-badge {
            display: inline-block;
            background: var(--gold);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: 0.5rem;
            font-weight: 600;
        }

        /* Seasonal Specials */
        .specials-carousel {
            position: relative;
            max-width: 1000px;
            margin: 2rem auto;
        }

        .special-card {
            background: linear-gradient(135deg, rgba(201, 169, 110, 0.3) 0%, rgba(139, 115, 85, 0.3) 100%);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2.5rem;
            border: 1px solid var(--gold);
            display: flex;
            align-items: center;
            gap: 2rem;
            margin: 1rem 0;
            transition: transform 0.3s;
        }

        .special-card:hover {
            transform: translateX(10px);
        }

        .special-icon {
            font-size: 60px;
            min-width: 80px;
            text-align: center;
        }

        .special-info h3 {
            color: var(--gold);
            margin-bottom: 0.5rem;
        }

        .special-badge {
            display: inline-block;
            background: #e74c3c;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        /* Order Tracking */
        .tracking-section {
            max-width: 700px;
            margin: 2rem auto;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(201, 169, 110, 0.2);
        }

        .tracking-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 2rem 0;
            position: relative;
        }

        .tracking-step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .step-icon {
            width: 60px;
            height: 60px;
            background: var(--gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
            margin: 0 auto 0.5rem;
            box-shadow: 0 0 20px rgba(201, 169, 110, 0.5);
        }

        .step-icon.completed {
            background: #27ae60;
        }

        .tracking-step.completed .step-icon {
            background: #27ae60;
        }

        .step-line {
            position: absolute;
            top: 30px;
            left: 0;
            height: 2px;
            background: rgba(201, 169, 110, 0.3);
            z-index: 1;
        }

        .step-line.completed {
            background: #27ae60;
        }

        /* Gift Card Section */
        .gift-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .gift-card {
            background: linear-gradient(135deg, var(--gold) 0%, #8b7355 100%);
            border-radius: 20px;
            padding: 2.5rem;
            color: white;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 10px 30px rgba(201, 169, 110, 0.3);
        }

        .gift-card:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(201, 169, 110, 0.5);
        }

        .gift-amount {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .gift-description {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .gift-btn {
            background: white;
            color: var(--gold);
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .gift-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Live Availability */
        .availability-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(39, 174, 96, 0.2);
            border: 1px solid #27ae60;
            color: #27ae60;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .availability-dot {
            width: 8px;
            height: 8px;
            background: #27ae60;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.7); }
            50% { box-shadow: 0 0 0 8px rgba(39, 174, 96, 0); }
        }

        /* Mobile App Promo */
        .app-promo {
            background: linear-gradient(135deg, rgba(201, 169, 110, 0.1) 0%, rgba(139, 115, 85, 0.1) 100%);
            border-radius: 20px;
            padding: 3rem;
            border: 2px dashed var(--gold);
            text-align: center;
            margin: 2rem 0;
        }

        .app-promo-icon {
            font-size: 60px;
            margin-bottom: 1rem;
        }

        .app-promo h3 {
            color: var(--gold);
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
        }

        .app-promo p {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 1.5rem;
        }

        .app-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .app-btn {
            background: var(--gold);
            color: white;
            padding: 0.8rem 2rem;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .app-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(201, 169, 110, 0.4);
        }

        /* Live Chat Badge */
        .chat-badge {
            position: absolute;
            bottom: 80px;
            right: 30px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 0.75rem 1.2rem;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            animation: slideInRight 0.5s, pulse 2s infinite;
            z-index: 999;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chat-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.6);
        }

        .chat-badge::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #fff;
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Responsive tweaks */
        .nav-toggle { display: none; }

        @media (max-width: 900px) {
            .nav-links {
                display: none;
                position: fixed;
                top: 70px;
                right: 0;
                width: 80%;
                max-width: 320px;
                height: calc(100% - 70px);
                background: rgba(15, 15, 15, 0.98);
                flex-direction: column;
                padding: 2rem;
                gap: 1.5rem;
                box-shadow: -10px 0 30px rgba(0,0,0,0.7);
                z-index: 1500;
                overflow-y: auto;
                transition: transform 0.25s ease;
            }

            .nav-links.open { display: flex; }

            .nav-icons { gap: 0.75rem; }

            .brand-name { font-size: 20px; }

            .nav-toggle {
                display: block;
                font-size: 24px;
                background: none;
                border: none;
                color: var(--light);
                cursor: pointer;
            }

            .hero {
                height: auto;
                min-height: 60vh;
                padding: 120px 5% 3rem;
            }

            .hero h1 { font-size: 3rem; }
            .hero p { font-size: 1rem; }

            .btn-primary { padding: .9rem 1.6rem; font-size: 1rem; }

            .gallery-item { height: 220px; border-radius: 12px; }
            .menu-card img, .product-card img { height: 160px; }
            .menu-grid, .products-grid, .gallery-grid { gap: 1rem; }

            .icon-btn, .icon-btn-small, .chat-button { transform: none; }
            .icon-btn { font-size: 20px; padding: 8px; }
            .icon-btn-small { width: 46px; height: 46px; }

            .chat-window { width: 90vw; right: 5vw; left: auto; }
        }

        @media (max-width: 480px) {
            .hero h1 { font-size: 2.2rem; }
            .nav-links { width: 100%; max-width: none; }
            .brand-name { font-size: 18px; }
            .menu-card, .product-card { padding: 1rem; }
            .form-group input, .form-group textarea, .form-group select { padding: .9rem; }
        }
    </style>
</head>
<body>
    <nav>
        <div class="logo-container">
            <div class="logo">‚òï</div>
            <div class="brand-name">BREWLUXE</div>
        </div>
        <ul class="nav-links">
            <li><a href="#home">Home</a></li>
            <li><a href="#gallery">Gallery</a></li>
            <li><a href="#menu">Menu</a></li>
            <li><a href="#products">Products</a></li>
            <li><a href="#specials">Specials</a></li>
            <li><a href="#baristas">Baristas</a></li>
            <li><a href="#reviews">Reviews</a></li>
            <li><a href="#contact">Contact</a></li>
        </ul>
        <div class="nav-icons">
            <button class="icon-btn nav-toggle" id="navToggle" aria-label="Toggle navigation">‚ò∞</button>
            <button class="theme-toggle" id="themeToggle" title="Toggle Theme">üåô</button>
            <button class="icon-btn" id="searchBtn" title="Search (Ctrl+K)">üîç</button>
            <button class="icon-btn" id="notificationBtn" title="Notifications">
                üîî
                <span class="badge" id="notifBadge">3</span>
            </button>
            <button class="icon-btn" id="cartBtn" title="Cart">
                üõí
                <span class="badge" id="cartBadge">0</span>
            </button>
            <div id="userBadge" style="display:flex; align-items:center; gap:8px; color:var(--light); font-size:14px;"></div>
        </div>
    </nav>

    <!-- Promo Countdown Banner (new) -->
    <div class="promo-banner" id="promoBanner" style="display:none;">
        <div class="promo-content">
            <div class="promo-text">Limited Time: <strong>20% OFF Holiday Bundle</strong> ‚Äî Ends in <span id="promoCountdown">00:00:00</span></div>
            <button class="btn-primary" id="promoCTA" onclick="scrollToSection('specials')">Grab Offer</button>
            <button class="close-promo" id="closePromo" aria-label="Close Promotion">√ó</button>
        </div>
    </div>

    <section class="hero" id="home">
        <video class="hero-video" autoplay muted loop playsinline>
            <source src="https://cdn.coverr.co/videos/coverr-pouring-coffee-in-a-cup-9635/1080p.mp4" type="video/mp4">
        </video>
        <div class="hero-content">
            <h1>BREWLUXE</h1>
            <p>Where Every Sip Tells a Story</p>
            <button class="btn-primary" onclick="scrollToSection('menu')">Explore Menu</button>
        </div>
    </section>

    <section id="about">
        <h2 class="section-title">Our Story</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">5</div>
                <p>Years of Excellence</p>
            </div>
            <div class="stat-card">
                <div class="stat-number">5K+</div>
                <p>Happy Customers</p>
            </div>
            <div class="stat-card">
                <div class="stat-number">25+</div>
                <p>Coffee Varieties</p>
            </div>
            <div class="stat-card">
                <div class="stat-number">4.5‚òÖ</div>
                <p>Average Rating</p>
            </div>
        </div>
    </section>

    <section id="gallery">
        <h2 class="section-title">Gallery</h2>
        <div class="gallery-grid" id="galleryGrid"></div>
        
        
    
    </section>

    <section id="menu">
        <h2 class="section-title">Our Signature Menu</h2>
        <div class="menu-grid" id="menuGrid"></div>
    </section>

    <section id="products">
        <h2 class="section-title">Premium Coffee Beans</h2>
        <div class="products-grid" id="productsGrid"></div>
    </section>

    <!-- NEW SECTIONS -->
    
    <!-- Seasonal Specials Section -->
    <section id="specials">
        <h2 class="section-title">üéâ Seasonal Specials</h2>
        <div class="specials-carousel" id="specialsCarousel"></div>
        <div class="app-promo">
            <div class="app-promo-icon">üì±</div>
            <h3>Download Our Mobile App</h3>
            <p>Get exclusive app-only deals and earn bonus loyalty points!</p>
            <div class="app-buttons">
                <button class="app-btn">üçé App Store</button>
                <button class="app-btn">ü§ñ Google Play</button>
            </div>
        </div>
    </section>

    <!-- Meet Our Baristas Section -->
    <section id="baristas">
        <h2 class="section-title">Meet Our Expert Baristas</h2>
        <p style="text-align: center; color: rgba(255,255,255,0.7); margin-bottom: 2rem; font-size: 1.1rem;">
            Skilled coffee artisans dedicated to crafting your perfect cup
        </p>
        <div class="barista-grid" id="baristaGrid"></div>
    </section>

    <!-- Order Tracking Section -->
    <section id="tracking">
        <h2 class="section-title">Real-Time Order Tracking</h2>
        <div class="tracking-section">
            <h3 style="text-align: center; color: var(--gold); margin-bottom: 2rem;">Track Your Order</h3>
            <div class="tracking-steps" id="trackingSteps">
                <div class="tracking-step completed">
                    <div class="step-icon completed">‚úì</div>
                    <p style="font-size: 0.9rem;">Order Confirmed</p>
                </div>
                <div class="step-line completed"></div>
                <div class="tracking-step completed">
                    <div class="step-icon completed">‚úì</div>
                    <p style="font-size: 0.9rem;">Preparing</p>
                </div>
                <div class="step-line"></div>
                <div class="tracking-step">
                    <div class="step-icon">üöÄ</div>
                    <p style="font-size: 0.9rem;">On The Way</p>
                </div>
                <div class="step-line"></div>
                <div class="tracking-step">
                    <div class="step-icon">üéØ</div>
                    <p style="font-size: 0.9rem;">Delivered</p>
                </div>
            </div>
            <div style="text-align: center; margin-top: 1.5rem;">
                <p style="color: rgba(255,255,255,0.7); margin-bottom: 1rem;">Estimated Delivery: <strong style="color: var(--gold);">8 minutes</strong></p>
                <div class="availability-badge">
                    <span class="availability-dot"></span>
                    Open & Ready to Serve
                </div>
            </div>
        </div>
    </section>

    <!-- Gift Cards Section -->
    <section id="gift-cards">
        <h2 class="section-title">üéÅ Gift Cards</h2>
        <p style="text-align: center; color: rgba(255,255,255,0.7); margin-bottom: 2rem;">
            Perfect gift for coffee lovers - Give the gift of premium coffee
        </p>
        <div class="gift-cards-grid" id="giftCardsGrid"></div>
    </section>

    <section id="reviews">
        <h2 class="section-title">What Our Customers Say</h2>
        <div class="reviews-container">
            <div class="review-slides" id="reviewSlides"></div>
            <div class="carousel-controls">
                <button class="carousel-btn" onclick="changeReview(-1)">‚Üê</button>
                <button class="carousel-btn" onclick="changeReview(1)">‚Üí</button>
            </div>
        </div>
    </section>

    <section id="loyalty">
        <h2 class="section-title">Loyalty Rewards</h2>
        <div class="loyalty-card">
            <h3>Your Points</h3>
            <div class="points-display" id="pointsDisplay">0</div>
            <p>Points to Gold Member: <span id="pointsToGold">750</span></p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <p style="margin-top: 1rem;">Earn 10% back on every purchase!</p>
        </div>
    </section>

    <section id="contact">
        <h2 class="section-title">Get In Touch</h2>
        <form class="contact-form" id="contactForm">
            <div class="form-group">
                <label>Name</label>
                <input type="text" name="name" required>
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" name="email" required>
            </div>
            <div class="form-group">
                <label>Phone</label>
                <input type="tel" name="phone">
            </div>
            <div class="form-group">
                <label>Subject</label>
                <select name="subject">
                    <option value="general">General Inquiry</option>
                    <option value="catering">Catering Services</option>
                    <option value="wholesale">Wholesale</option>
                    <option value="feedback">Feedback</option>
                </select>
            </div>
            <div class="form-group">
                <label>Message</label>
                <textarea name="message" rows="5" required></textarea>
            </div>
            <button type="submit" class="btn-primary">Send Message</button>
        </form>
        <iframe class="map" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d30153.788252261566!2d72.82321484621745!3d19.141690214227783!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3be7b63aceef0c69%3A0x2aa80cf2287dfa3b!2sJogeshwari%20West%2C%20Mumbai%2C%20Maharashtra%20400047!5e0!3m2!1sen!2sin!4v1629452077891!5m2!1sen!2sin" 
     allowfullscreen="" 
      loading="lazy">
     </iframe>

    </section>

    <footer>
        <div class="logo-container" style="justify-content: center; margin-bottom: 1rem;">
            <div class="logo">‚òï</div>
            <div class="brand-name">BREWLUXE</div>
        </div>
        <p>Where Every Sip Tells a Story</p>
        <p style="margin-top: 1rem; color: rgba(255,255,255,0.6);">123 Jogeshwari West , Mumbai, Maharashtra</p>
        <p style="color: rgba(255,255,255,0.6);">Mon-Fri: 6AM-8PM | Sat-Sun: 7AM-9PM</p>
        <div class="social-icons">
            <a href="#" class="social-icon" title="Facebook">üìò</a>
            <a href="#" class="social-icon" title="Instagram">üì∑</a>
            <a href="#" class="social-icon" title="Twitter">üê¶</a>
            <a href="#" class="social-icon" title="Location">üìç</a>
        </div>
        <p>&copy; 2025 BREWLUXE. All rights reserved.</p>
    </footer>

    <div class="chat-badge" id="chatBadge" onclick="toggleChat(); scrollToChat();" title="Click to chat with us!">
        <span>üí¨</span>
        <span>We're Online!</span>
        <span class="badge-pulse"></span>
    </div>
    
    <div class="chat-widget">
        <button class="chat-button" id="chatToggle">üí¨</button>
        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                <h3>Chat with BREWLUXE</h3>
                <div style="display:flex; gap:8px; align-items:center;">
                    <button class="icon-btn" id="setNameBtn" title="Set name">üë§</button>
                    <button class="icon-btn" id="clearChatBtn" title="Clear chat">üóëÔ∏è</button>
                    <button class="close-btn" onclick="toggleChat()" style="position: static;">√ó</button>
                </div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message bot">Hello! How can I help you today?</div>
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="Type a message...">
                <button class="send-btn" onclick="sendChatMessage()">‚û§</button>
            </div>
        </div>
    </div>

    <div class="modal" id="searchModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeSearch()">√ó</button>
            <h2>Search Menu</h2>
            <div class="form-group">
                <input type="text" id="searchInput" placeholder="Search for coffee..." style="width: 100%;">
            </div>
            <div id="searchResults"></div>
        </div>
    </div>

    <div class="modal" id="newsletterModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeNewsletter()">√ó</button>
            <h2>Subscribe to Newsletter</h2>
            <p>Get exclusive offers and +20 loyalty points!</p>
            <form class="newsletter-form" id="newsletterForm">
                <input type="email" placeholder="Enter your email" required>
                <button type="submit" class="btn-primary">Subscribe</button>
            </form>
        </div>
    </div>

    <div class="modal" id="notificationsModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeNotifications()">√ó</button>
            <h2>Notifications</h2>
            <div id="notificationsList" style="max-height:300px; overflow:auto; margin-top: 0.5rem;">
                <!-- notifications rendered here -->
            </div>
            <div style="margin-top:1rem; text-align: right;">
                <button class="btn-primary" onclick="clearNotifications()">Clear All</button>
            </div>
        </div>
    </div>

    <div class="modal" id="orderTrackingModal">
        <div class="modal-content" style="max-width: 600px;">
            <button class="close-btn" onclick="closeOrderTracking()">√ó</button>
            <h2>üìç Real-Time Order Tracking</h2>
            <div style="margin-top: 1.5rem;">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <p style="color: var(--gold); font-size: 1.3rem; font-weight: 600; margin-bottom: 0.5rem;">Order #<span id="trackingOrderId"></span></p>
                    <div id="trackingStatus" style="font-weight: 600; color: var(--gold); font-size: 1.1rem;">Loading...</div>
                </div>
                <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <div style="text-align: center; flex: 1;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìã</div>
                            <div style="font-size: 0.85rem; color: rgba(255,255,255,0.8);">Received</div>
                        </div>
                        <div style="height: 2px; flex: 1; background: rgba(255,255,255,0.2);"></div>
                        <div style="text-align: center; flex: 1;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;" id="statusPrep">‚è≥</div>
                            <div style="font-size: 0.85rem; color: rgba(255,255,255,0.8);">Preparing</div>
                        </div>
                        <div style="height: 2px; flex: 1; background: rgba(255,255,255,0.2);"></div>
                        <div style="text-align: center; flex: 1;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;" id="statusQuality">‚è≥</div>
                            <div style="font-size: 0.85rem; color: rgba(255,255,255,0.8);">QA Check</div>
                        </div>
                        <div style="height: 2px; flex: 1; background: rgba(255,255,255,0.2);"></div>
                        <div style="text-align: center; flex: 1;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;" id="statusReady">‚è≥</div>
                            <div style="font-size: 0.85rem; color: rgba(255,255,255,0.8);">Ready</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 1rem; background: rgba(201, 169, 110, 0.1); border-radius: 8px; border-left: 4px solid var(--gold); margin-bottom: 1.5rem;">
                    <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--gold);">‚è± Est. Pickup: <span id="trackingETA">~15 mins</span></div>
                    <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8);">We'll notify you when ready for pickup/delivery</div>
                </div>
                <div id="trackingUpdates" style="background: rgba(255,255,255,0.02); padding: 1rem; border-radius: 8px; max-height: 150px; overflow-y: auto; font-size: 0.85rem;">
                    <div style="color: rgba(255,255,255,0.7);">Updates will appear here...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="cartModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeCart()">√ó</button>
            <h2>Your Cart</h2>
            <div class="cart-modal-content" id="cartModalContent"></div>
            <div class="cart-total">
                Total: $<span id="cartTotal">0.00</span>
            </div>
            <button class="btn-primary" style="width: 100%; margin-top: 1rem;" onclick="proceedToCheckout()">Proceed to Checkout</button>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content" style="max-width:420px;">
            <button class="close-btn" onclick="closeLogin()">√ó</button>
            <h2>Sign in to BREWLUXE</h2>
            <p style="color: rgba(255,255,255,0.7);">Please sign in to continue with your order.</p>
            <form id="loginForm" style="margin-top:1rem;">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" required placeholder="you@example.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" required placeholder="Enter a password">
                </div>
                <div style="display:flex; gap:0.5rem; align-items:center; margin-bottom:1rem;">
                    <input type="checkbox" id="rememberMe" />
                    <label for="rememberMe" style="margin:0; color:var(--gold);">Remember me</label>
                </div>
                <button type="submit" class="btn-primary" style="width:100%;">Sign In</button>
                <button type="button" class="btn-primary" style="width:100%; margin-top:0.5rem; background:transparent; border:1px solid rgba(255,255,255,0.08);" onclick="continueAsGuest()">Continue as Guest</button>
            </form>
        </div>
    </div>

    <div class="modal" id="checkoutModal">
        <div class="modal-content" style="max-width: 800px;">
            <button class="close-btn" onclick="closeCheckout()">√ó</button>
            <h2>Checkout</h2>
            
            <div id="checkoutContent">
                <div class="form-group">
                    <label>Order Type</label>
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <button class="order-type-btn active" onclick="setOrderType('pickup')" id="pickupBtn">
                            üè™ Pickup
                        </button>
                        <button class="order-type-btn" onclick="setOrderType('delivery')" id="deliveryBtn">
                            üöó Delivery
                        </button>
                    </div>
                </div>

                <form id="checkoutForm">
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" name="fullName" required>
                    </div>

                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" name="email" required>
                    </div>

                    <div class="form-group">
                        <label>Phone Number *</label>
                        <input type="tel" name="phone" required>
                    </div>

                    <div id="deliveryFields" style="display: none;">
                        <div class="form-group">
                            <label>Delivery Address *</label>
                            <input type="text" name="address" placeholder="Street Address">
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label>City *</label>
                                <input type="text" name="city">
                            </div>
                            <div class="form-group">
                                <label>Postal Code *</label>
                                <input type="text" name="postalCode">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Delivery Instructions</label>
                            <textarea name="instructions" rows="2" placeholder="Any special instructions for delivery..."></textarea>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Special Requests</label>
                        <textarea name="specialRequests" rows="2" placeholder="Allergies, preferences, etc..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Payment Method</label>
                        <select name="paymentMethod" id="paymentMethod">
                            <option value="card">Credit/Debit Card</option>
                            <option value="cash">Cash on Delivery</option>
                            <option value="upi">UPI Payment</option>
                        </select>
                    </div>

                    <div id="cardFields">
                        <div class="form-group">
                            <label>Card Number</label>
                            <input type="text" name="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label>Expiry Date</label>
                                <input type="text" name="expiry" placeholder="MM/YY" maxlength="5">
                            </div>
                            <div class="form-group">
                                <label>CVV</label>
                                <input type="text" name="cvv" placeholder="123" maxlength="3">
                            </div>
                        </div>
                    </div>

                    <div class="order-summary" style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 10px; margin: 1.5rem 0;">
                        <h3 style="color: var(--gold); margin-bottom: 1rem;">Order Summary</h3>
                        <div id="checkoutItemsList"></div>
                        <div style="border-top: 1px solid rgba(201,169,110,0.3); margin-top: 1rem; padding-top: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Subtotal:</span>
                                <span>$<span id="checkoutSubtotal">0.00</span></span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;" id="deliveryFeeRow" style="display: none;">
                                <span>Delivery Fee:</span>
                                <span>$<span id="deliveryFee">3.99</span></span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 1.3rem; color: var(--gold); font-weight: 600;">
                                <span>Total:</span>
                                <span>$<span id="checkoutTotal">0.00</span></span>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn-primary" style="width: 100%;" onclick="submitCheckoutForm(event)">Place Order</button>
                </form>
            </div>

            <div id="orderConfirmation" style="display: none; text-align: center; padding: 2rem;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">‚úÖ</div>
                <h2 style="color: var(--gold); margin-bottom: 1rem;">Order Confirmed!</h2>
                <p style="margin-bottom: 1rem;">Your order has been placed successfully.</p>
                <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 10px; margin: 1.5rem 0;">
                    <p style="color: var(--gold); font-size: 1.2rem; margin-bottom: 0.5rem;">Order #<span id="orderNumber"></span></p>
                    <div style="margin: 1rem 0;">
                        <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8); margin-bottom: 0.5rem;">Status</div>
                        <div id="orderStatus" style="font-weight: 600; color: var(--gold);">Received</div>
                    </div>
                    <p style="color: rgba(255,255,255,0.7);">Estimated time: <span id="estimatedTime"></span></p>
                    <div id="orderTrackingBar" style="margin-top: 1.5rem; background: rgba(255,255,255,0.1); height: 6px; border-radius: 3px; overflow: hidden;">
                        <div id="trackingProgress" style="width: 10%; height: 100%; background: var(--gold); transition: width 0.3s ease;"></div>
                    </div>
                </div>
                <p style="margin-bottom: 1.5rem;">We'll send you updates via email and SMS.</p>
                <button class="btn-primary" onclick="closeCheckout()">Done</button>
                <button class="icon-btn" onclick="viewFullTracking()" title="View full tracking" style="margin-left: 0.5rem;">üìç</button>
            </div>
        </div>
    </div>

    <div class="lightbox" id="lightbox">
        <button class="lightbox-close" onclick="closeLightbox()">√ó</button>
        <div id="lightboxContent"></div>
    </div>

    <script>
        const galleryItems = [
            { type: 'image', src: 'https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=800&h=600&fit=crop', title: 'Fresh Brew', desc: 'Morning perfection' },
            { type: 'image', src: 'https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=800&h=600&fit=crop', title: 'Coffee Beans', desc: 'Premium selection' },
            { type: 'video', src: 'https://cdn.coverr.co/videos/coverr-coffee-being-poured-into-a-cup-4622/1080p.mp4', title: 'Pour Perfection', desc: 'Art in motion' },
            { type: 'image', src: 'https://images.unsplash.com/photo-1511920170033-f8396924c348?w=800&h=600&fit=crop', title: 'Latte Art', desc: 'Handcrafted beauty' },
            { type: 'image', src: 'https://images.unsplash.com/photo-1442512595331-e89e73853f31?w=800&h=600&fit=crop', title: 'Coffee Shop', desc: 'Cozy atmosphere' },
            { type: 'image', src: 'https://images.unsplash.com/photo-1497935586351-b67a49e012bf?w=800&h=600&fit=crop', title: 'Espresso Shot', desc: 'Bold and rich' }
        ];

        const menuItems = [
            { id: 1, name: 'Espresso', description: 'Rich and bold Italian classic', price: 3.50, image: 'https://images.unsplash.com/photo-1579992357154-faf4bde95b3d?w=400&h=300&fit=crop' },
            { id: 2, name: 'Cappuccino', description: 'Smooth espresso with steamed milk foam', price: 4.50, image: 'https://images.unsplash.com/photo-1572442388796-11668a67e53d?w=400&h=300&fit=crop' },
            { id: 3, name: 'Caramel Latte', description: 'Sweet caramel with creamy milk', price: 5.00, image: 'https://images.unsplash.com/photo-1461023058943-07fcbe16d735?w=400&h=300&fit=crop' },
            { id: 4, name: 'Mocha', description: 'Chocolate and espresso perfection', price: 5.50, image: 'https://images.unsplash.com/photo-1607260550778-aa9d29444ce1?w=400&h=300&fit=crop' },
            { id: 5, name: 'Flat White', description: 'Velvety microfoam with espresso', price: 4.75, image: 'https://images.unsplash.com/photo-1542990253-0d0f5be5f0ed?w=400&h=300&fit=crop' },
            { id: 6, name: 'Cold Brew', description: 'Smooth, refreshing cold-steeped coffee', price: 4.25, image: 'https://images.unsplash.com/photo-1517487881594-2787fef5ebf7?w=400&h=300&fit=crop' },
            { id: 7, name: 'Macchiato', description: 'Espresso marked with foam', price: 3.75, image: 'https://images.unsplash.com/photo-1557006021-b85faa2bc5e2?w=400&h=300&fit=crop' },
            { id: 8, name: 'Affogato', description: 'Espresso over vanilla ice cream', price: 6.00, image: 'https://images.unsplash.com/photo-1563741451-a0f6a7624c95?w=400&h=300&fit=crop' }
        ];

        const products = [
            { id: 101, name: 'Ethiopian Blend', description: 'Fruity and floral notes', price: 18.99, rating: 5, image: 'https://images.unsplash.com/photo-1559056199-641a0ac8b55e?w=400&h=300&fit=crop' },
            { id: 102, name: 'Colombian Supreme', description: 'Rich and balanced', price: 16.99, rating: 4, image: 'https://images.unsplash.com/photo-1447933601403-0c6688de566e?w=400&h=300&fit=crop' },
            { id: 103, name: 'Italian Roast', description: 'Dark and intense', price: 15.99, rating: 5, image: 'https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?w=400&h=300&fit=crop' },
            { id: 104, name: 'Brazilian Santos', description: 'Smooth and nutty', price: 17.99, rating: 4, image: 'https://images.unsplash.com/photo-1511537190424-bbbab87ac5eb?w=400&h=300&fit=crop' },
            { id: 105, name: 'Sumatra Mandheling', description: 'Full-bodied and earthy', price: 19.99, rating: 5, image: 'https://images.unsplash.com/photo-1525385133512-2f3bdd039054?w=400&h=300&fit=crop' },
            { id: 106, name: 'Kenya AA', description: 'Bright and wine-like', price: 20.99, rating: 5, image: 'https://images.unsplash.com/photo-1610889556528-9a770e32642f?w=400&h=300&fit=crop' }
        ];

        const reviews = [
            { name: 'Sarah Johnson', avatar: 'https://i.pravatar.cc/150?img=1', rating: 5, date: '2025-09-15', text: 'Absolutely love Caff√®luxe! The espresso is perfectly brewed every time, and the ambiance is so cozy. The loyalty program is a great bonus!' },
            { name: 'Michael Chen', avatar: 'https://i.pravatar.cc/150?img=13', rating: 5, date: '2025-09-20', text: 'Best coffee shop in town! Their Ethiopian blend is phenomenal. Staff is incredibly friendly and knowledgeable about their beans.' },
            { name: 'Emily Rodriguez', avatar: 'https://i.pravatar.cc/150?img=5', rating: 4, date: '2025-09-22', text: 'Great selection of drinks and the atmosphere is perfect for working. The caramel latte is my go-to. Highly recommend!' },
            { name: 'David Thompson', avatar: 'https://i.pravatar.cc/150?img=12', rating: 5, date: '2025-09-25', text: 'Premium quality coffee at reasonable prices. The loyalty points system is generous and the customer service is outstanding!' },
            { name: 'Lisa Martinez', avatar: 'https://i.pravatar.cc/150?img=9', rating: 5, date: '2025-09-28', text: 'My favorite coffee spot! The cold brew is incredibly smooth and the online ordering makes it so convenient. Love the chat support too!' },
            { name: 'James Wilson', avatar: 'https://i.pravatar.cc/150?img=14', rating: 4, date: '2025-10-01', text: 'Fantastic coffee and great vibes. The website makes ordering easy and the rewards program keeps me coming back. Well worth it!' }
        ];

        // NEW FEATURES DATA
        const specials = [
            { icon: '‚ùÑÔ∏è', title: 'Winter Wonderland Latte', desc: 'Peppermint, cinnamon & cocoa - Perfect for cold days!', discount: '20% OFF', price: '$5.99' },
            { icon: 'üçÅ', title: 'Autumn Spice Cappuccino', desc: 'Seasonal spice blend with premium espresso', discount: '15% OFF', price: '$4.99' },
            { icon: 'üéÑ', title: 'Holiday Special Bundle', desc: 'Any 2 drinks + pastry combo - Great for gifts!', discount: '30% OFF', price: '$12.99' }
        ];

        const baristas = [
            { id: 1, name: 'Alex Rivera', emoji: 'üë®‚Äçüç≥', title: 'Head Barista', specialty: 'Espresso Expert', badge: 'Master', bio: '12+ years experience crafting perfect espresso shots' },
            { id: 2, name: 'Sofia Chen', emoji: 'üë©‚Äçüç≥', title: 'Senior Barista', specialty: 'Latte Art Master', badge: 'Pro', bio: 'Award-winning latte artist with creative designs' },
            { id: 3, name: 'Marco Santos', emoji: 'üßë‚Äçüç≥', title: 'Barista', specialty: 'Cold Brew Specialist', badge: 'Expert', bio: 'Perfected cold brew recipes for summer favorites' },
            { id: 4, name: 'Emma Watson', emoji: 'üë©‚Äçüç≥', title: 'Barista', specialty: 'Flavor Innovator', badge: 'Rising Star', bio: 'Creating new seasonal drinks and flavor combinations' }
        ];

        const giftCards = [
            { amount: '$25', description: 'Perfect for occasional coffee lovers', perks: '3 Free Upgrades' },
            { amount: '$50', description: 'Great for regular customers', perks: '7 Free Upgrades + 10% Bonus' },
            { amount: '$100', description: 'Premium gift for true coffee enthusiasts', perks: '15 Free Upgrades + 20% Bonus' },
            { amount: '$250', description: 'The ultimate coffee lover gift', perks: 'VIP Status + All Perks' }
        ];

        // Notifications store (simple client-side list)
        const notifications = [
            { id: 'n1', title: 'Welcome offer', text: 'Welcome to BREWLUXE! Enjoy 10% off your first order.', time: new Date().toISOString(), seen: false },
            { id: 'n2', title: 'New blend', text: 'Try our new Ethiopian Blend with fruity notes.', time: new Date().toISOString(), seen: false },
            { id: 'n3', title: 'Double points', text: 'Earn double loyalty points today on all orders!', time: new Date().toISOString(), seen: false }
        ];

        let cart = [];
        let favorites = [];
        let loyaltyPoints = 0;
        let currentReview = 0;

        window.addEventListener('DOMContentLoaded', () => {
            renderGallery();
            renderMenu();
            renderProducts();
            renderReviews();
            renderSpecials();
            renderBaristas();
            renderGiftCards();
            setupThemeToggle();
            updateOnlineStatus();
            showToast('Welcome to Caff√®luxe!');
            startReviewCarousel();
            setupEventListeners();
            updateNotificationBadge();
            
            // Load chat history if present; otherwise show starter message
            const loaded = loadChatHistory();
            if (!loaded) {
                const cm = document.getElementById('chatMessages');
                cm.innerHTML = '<div class="message bot">Hello! How can I help you today?</div>';
            }

            // render initial suggestions
            renderSuggestedReplies([
                { label: 'Show Menu', action: 'openMenu' },
                { label: 'Loyalty Points', action: 'send', payload: 'How many loyalty points do I have?' },
                { label: 'Delivery Info', action: 'send', payload: 'Do you deliver?' }
            ]);

            setTimeout(() => {
                document.getElementById('newsletterModal').classList.add('active');
            }, 5000);
            
            // Wire chat header buttons
            const clearBtn = document.getElementById('clearChatBtn');
            if (clearBtn) clearBtn.addEventListener('click', () => {
                if (confirm('Clear chat history?')) clearChat();
            });

            const setNameBtn = document.getElementById('setNameBtn');
            if (setNameBtn) setNameBtn.addEventListener('click', () => {
                const name = prompt('Enter your name to personalize chat:', localStorage.getItem('brewluxeChatName') || '');
                if (name !== null) {
                    localStorage.setItem('brewluxeChatName', name.trim());
                    saveChatHistory();
                    showToast(`Hi ${name.trim()} ‚Äî I'll remember you!`);
                }
            });
            // ensure user badge reflects login state on load
            updateUserBadge();
        });

        function renderGallery() {
            const grid = document.getElementById('galleryGrid');
            grid.innerHTML = galleryItems.map((item, index) => `
                <div class="gallery-item" onclick="openLightbox(${index})">
                    ${item.type === 'image' 
                        ? `<img src="${item.src}" alt="${item.title}">`
                        : `<video muted loop><source src="${item.src}" type="video/mp4"></video>`
                    }
                    <div class="gallery-overlay">
                        <h3>${item.title}</h3>
                        <p>${item.desc}</p>
                    </div>
                </div>
            `).join('');
            
            document.querySelectorAll('.gallery-item video').forEach(video => {
                video.addEventListener('mouseenter', () => video.play());
                video.addEventListener('mouseleave', () => video.pause());
            });
        }

        function openLightbox(index) {
            const item = galleryItems[index];
            const lightbox = document.getElementById('lightbox');
            const content = document.getElementById('lightboxContent');
            
            if (item.type === 'image') {
                content.innerHTML = `<img src="${item.src}" alt="${item.title}">`;
            } else {
                content.innerHTML = `<video controls autoplay><source src="${item.src}" type="video/mp4"></video>`;
            }
            
            lightbox.classList.add('active');
        }

        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
        }

        function renderMenu() {
            const grid = document.getElementById('menuGrid');
            grid.innerHTML = menuItems.map(item => `
                <div class="menu-card" data-id="${item.id}">
                    <img src="${item.image}" alt="${item.name}">
                    <h3>${item.name}</h3>
                    <p>${item.description}</p>
                    <div class="price-row">
                        <span class="price">${item.price.toFixed(2)}</span>
                        <div class="card-actions">
                            <button class="icon-btn-small fav-btn" onclick="toggleFavorite(${item.id}, 'menu')" title="Add to favorites">
                                ‚ù§Ô∏è
                            </button>
                            <button class="icon-btn-small" onclick="addToCart(${item.id}, 'menu')" title="Add to cart">
                                üõí
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = products.map(item => `
                <div class="product-card" data-id="${item.id}">
                    <img src="${item.image}" alt="${item.name}">
                    <h3>${item.name}</h3>
                    <div class="rating">${'‚≠ê'.repeat(item.rating)}</div>
                    <p>${item.description}</p>
                    <div class="price-row">
                        <span class="price">${item.price.toFixed(2)}</span>
                        <div class="card-actions">
                            <button class="icon-btn-small fav-btn" onclick="toggleFavorite(${item.id}, 'product')" title="Add to favorites">
                                ‚ù§Ô∏è
                            </button>
                            <button class="icon-btn-small" onclick="addToCart(${item.id}, 'product')" title="Add to cart">
                                üõí
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderReviews() {
            const container = document.getElementById('reviewSlides');
            container.innerHTML = reviews.map((review, index) => `
                <div class="review-slide ${index === 0 ? 'active' : ''}" data-index="${index}">
                    <img src="${review.avatar}" alt="${review.name}" class="review-avatar">
                    <h3>${review.name}</h3>
                    <div class="review-stars">${'‚≠ê'.repeat(review.rating)}</div>
                    <p style="font-style: italic; color: rgba(255,255,255,0.8);">"${review.text}"</p>
                    <p style="color: var(--gold); margin-top: 1rem; font-size: 0.9rem;">${review.date}</p>
                </div>
            `).join('');
        }

        // NEW RENDER FUNCTIONS
        function renderSpecials() {
            const carousel = document.getElementById('specialsCarousel');
            carousel.innerHTML = specials.map(special => `
                <div class="special-card">
                    <div class="special-icon">${special.icon}</div>
                    <div class="special-info" style="flex: 1;">
                        <div class="special-badge">${special.discount}</div>
                        <h3>${special.title}</h3>
                        <p style="color: rgba(255,255,255,0.8);">${special.desc}</p>
                        <p style="color: var(--gold); font-weight: 600; margin-top: 0.5rem;">${special.price}</p>
                    </div>
                </div>
            `).join('');
        }

        function renderBaristas() {
            const grid = document.getElementById('baristaGrid');
            grid.innerHTML = baristas.map(barista => `
                <div class="barista-card" onclick="toggleBaristaDetails(${barista.id})">
                    <div class="barista-avatar">${barista.emoji}</div>
                    <h3>${barista.name}</h3>
                    <p class="barista-title">${barista.title}</p>
                    <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem; margin-bottom: 1rem;">${barista.specialty}</p>
                    <span class="barista-badge">${barista.badge}</span>
                    <p class="barista-bio" style="display: none; margin-top: 1rem; font-size: 0.85rem; color: rgba(255,255,255,0.75); line-height: 1.4;">${barista.bio}</p>
                    <button class="icon-btn" style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.7;" title="Learn more">‚ÑπÔ∏è</button>
                </div>
            `).join('');
        }

        function toggleBaristaDetails(id) {
            const barista = baristas.find(b => b.id === id);
            if (!barista) return;
            
            const cards = document.querySelectorAll('.barista-card');
            cards.forEach(card => {
                const bio = card.querySelector('.barista-bio');
                if (bio && card !== event.currentTarget) {
                    bio.style.display = 'none';
                }
            });
            
            const bio = event.currentTarget.querySelector('.barista-bio');
            if (bio) {
                bio.style.display = bio.style.display === 'none' ? 'block' : 'none';
            }
        }

        function renderGiftCards() {
            const grid = document.getElementById('giftCardsGrid');
            grid.innerHTML = giftCards.map((card, index) => `
                <div class="gift-card">
                    <div class="gift-amount">${card.amount}</div>
                    <p class="gift-description">${card.description}</p>
                    <p style="font-size: 0.85rem; margin-bottom: 1rem; opacity: 0.9;">‚ú® ${card.perks}</p>
                    <button class="gift-btn" onclick="buyGiftCard('${card.amount}')">Buy Now</button>
                </div>
            `).join('');
        }

        function buyGiftCard(amount) {
            showToast(`üéÅ Gift Card ${amount} added to cart! Proceed to checkout.`);
            addLoyaltyPoints(10);
        }

        function setupThemeToggle() {
            const toggle = document.getElementById('themeToggle');
            const savedTheme = localStorage.getItem('brewluxeTheme') || 'dark';
            
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                toggle.textContent = '‚òÄÔ∏è';
            }
            
            toggle.addEventListener('click', () => {
                document.body.classList.toggle('light-mode');
                const isLight = document.body.classList.contains('light-mode');
                toggle.textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
                localStorage.setItem('brewluxeTheme', isLight ? 'light' : 'dark');
                showToast(`Theme switched to ${isLight ? 'Light' : 'Dark'} mode!`);
            });
        }

        function addToCart(id, type) {
            const item = type === 'menu' 
                ? menuItems.find(i => i.id === id)
                : products.find(i => i.id === id);
            
            const existing = cart.find(i => i.id === id && i.type === type);
            
            if (existing) {
                existing.quantity++;
            } else {
                cart.push({ ...item, type, quantity: 1 });
            }
            
            updateCartBadge();
            addLoyaltyPoints(item.price * 0.1);
            showToast(`${item.name} added to cart!`);
        }

        function updateCartBadge() {
            const badge = document.getElementById('cartBadge');
            const total = cart.reduce((sum, item) => sum + item.quantity, 0);
            badge.textContent = total;
        }

        function toggleFavorite(id, type) {
            const key = `${type}-${id}`;
            const index = favorites.indexOf(key);
            
            if (index > -1) {
                favorites.splice(index, 1);
                showToast('Removed from favorites');
            } else {
                favorites.push(key);
                showToast('Added to favorites!');
            }
            
            updateFavoriteButtons();
        }

        function updateFavoriteButtons() {
            document.querySelectorAll('.fav-btn').forEach(btn => {
                const card = btn.closest('[data-id]');
                if (!card) return;
                
                const id = card.dataset.id;
                const type = card.closest('#menuGrid') ? 'menu' : 'product';
                const key = `${type}-${id}`;
                
                if (favorites.includes(key)) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function addLoyaltyPoints(amount) {
            const points = Math.floor(amount * 10);
            loyaltyPoints += points;
            updateLoyaltyDisplay();
        }

        function updateLoyaltyDisplay() {
            document.getElementById('pointsDisplay').textContent = loyaltyPoints;
            const remaining = Math.max(0, 750 - loyaltyPoints);
            document.getElementById('pointsToGold').textContent = remaining;
            const progress = Math.min(100, (loyaltyPoints / 750) * 100);
            document.getElementById('progressFill').style.width = progress + '%';
            
            if (loyaltyPoints >= 750 && loyaltyPoints < 760) {
                showToast('Congratulations! You are now a Gold Member!');
            }
        }

        function changeReview(direction) {
            const slides = document.querySelectorAll('.review-slide');
            slides[currentReview].classList.remove('active');
            currentReview = (currentReview + direction + reviews.length) % reviews.length;
            slides[currentReview].classList.add('active');
        }

        function startReviewCarousel() {
            setInterval(() => changeReview(1), 5000);
        }

        function toggleChat() {
            document.getElementById('chatWindow').classList.toggle('active');
        }

        function scrollToChat() {
            const badge = document.getElementById('chatBadge');
            if (badge) {
                badge.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        function updateOnlineStatus() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const timeStr = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
            
            // Check if within business hours (6 AM - 9 PM)
            const isOpen = hours >= 6 && hours < 21;
            
            const badge = document.getElementById('chatBadge');
            if (badge) {
                if (isOpen) {
                    badge.innerHTML = `<span>üí¨</span><span>We're Online! üü¢</span><span class="badge-pulse"></span>`;
                    badge.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
                    badge.title = `Open until 9:00 PM (Currently: ${timeStr})`;
                } else {
                    badge.innerHTML = `<span>üí¨</span><span>Back Tomorrow! üåô</span>`;
                    badge.style.background = 'linear-gradient(135deg, #34495e, #445566)';
                    badge.style.opacity = '0.7';
                    badge.title = `We're closed. We open at 6:00 AM`;
                    badge.style.cursor = 'default';
                }
            }
        }

        // Update online status every minute
        setInterval(updateOnlineStatus, 60000);

        document.getElementById('chatToggle').addEventListener('click', toggleChat);
        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendChatMessage();
        });

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addUserMessage(message);
            input.value = '';
            
            setTimeout(() => handleChatResponse(message.toLowerCase()), 800);
        }

        function addUserMessage(text) {
            const container = document.getElementById('chatMessages');
            const msg = document.createElement('div');
            msg.className = 'message user';
            const ts = formatTime(new Date());
            const name = (localStorage.getItem('brewluxeChatName') || 'You');
            msg.innerHTML = `<div class="message-text">${escapeHtml(text)}</div><div class="msg-meta"><span class="msg-name">${escapeHtml(name)}</span> <span class="msg-time">${ts}</span></div>`;
            container.appendChild(msg);
            container.scrollTop = container.scrollHeight;
            saveChatHistory();
        }

        function addBotMessage(text) {
            hideBotTyping();
            const container = document.getElementById('chatMessages');
            const msg = document.createElement('div');
            msg.className = 'message bot';
            const ts = formatTime(new Date());
            msg.innerHTML = `<div class="message-text">${escapeHtml(text)}</div><div class="msg-meta"><span class="msg-name">BREWLUXE</span> <span class="msg-time">${ts}</span></div>`;
            container.appendChild(msg);
            container.scrollTop = container.scrollHeight;
            saveChatHistory();
        }

        // Chat persistence and helpers
        function saveChatHistory() {
            try {
                const messages = [...document.querySelectorAll('#chatMessages .message')].map(m => ({
                    role: m.classList.contains('user') ? 'user' : 'bot',
                    text: m.textContent,
                    time: m.querySelector('.msg-time') ? m.querySelector('.msg-time').textContent : ''
                }));

                const name = localStorage.getItem('brewluxeChatName') || '';
                localStorage.setItem('brewluxeChatHistory', JSON.stringify({ name, messages }));
            } catch (e) {
                console.error('Failed to save chat history', e);
            }
        }

        // Utilities for chat
        function formatTime(dt) {
            const d = dt || new Date();
            return d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function escapeHtml(unsafe) {
            return String(unsafe).replace(/[&<>"]+/g, function (s) {
                return ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;' })[s];
            });
        }

        function loadChatHistory() {
            try {
                const raw = localStorage.getItem('brewluxeChatHistory');
                if (!raw) return false;
                const parsed = JSON.parse(raw);
                const container = document.getElementById('chatMessages');
                container.innerHTML = '';

                if (parsed.name) {
                    addBotMessage(`Welcome back ${parsed.name}! What can I help you with today?`);
                }

                (parsed.messages || []).forEach(msg => {
                    const node = document.createElement('div');
                    node.className = `message ${msg.role}`;
                    node.textContent = msg.text;
                    container.appendChild(node);
                });

                container.scrollTop = container.scrollHeight;
                return true;
            } catch (e) {
                console.error('Failed to load chat history', e);
                return false;
            }
        }

        function clearChat() {
            localStorage.removeItem('brewluxeChatHistory');
            const container = document.getElementById('chatMessages');
            container.innerHTML = '';
            addBotMessage('Hello! How can I help you today?');
        }

        // --- Login / User handling ---
        function isLoggedIn() {
            return !!localStorage.getItem('brewluxeUser');
        }

        function getLoggedInUser() {
            try {
                return JSON.parse(localStorage.getItem('brewluxeUser') || 'null');
            } catch (e) { return null; }
        }

        function openLogin(callback) {
            document.getElementById('loginModal').classList.add('active');
            window.__postLoginCallback = callback || null;
        }

        function closeLogin() {
            document.getElementById('loginModal').classList.remove('active');
        }

        function continueAsGuest() {
            // mark temporary guest (no persistence)
            localStorage.removeItem('brewluxeUser');
            closeLogin();
            if (window.__postLoginCallback) {
                const cb = window.__postLoginCallback; window.__postLoginCallback = null; cb();
            }
        }

        document.addEventListener('submit', (e) => {
            if (e.target && e.target.id === 'loginForm') {
                e.preventDefault();
                const form = e.target;
                const email = (form.querySelector('input[name="email"]').value || '').trim();
                const password = (form.querySelector('input[name="password"]').value || '').trim();
                const remember = !!form.querySelector('#rememberMe').checked;

                if (!email || !password) {
                    showToast('Please enter email and password');
                    return;
                }

                // Very simple client-side "auth": accept any non-empty password
                const user = { email, name: email.split('@')[0] };
                if (remember) {
                    localStorage.setItem('brewluxeUser', JSON.stringify(user));
                } else {
                    // store but not persistent across sessions? We'll keep it in localStorage for simplicity
                    localStorage.setItem('brewluxeUser', JSON.stringify(user));
                }

                updateUserBadge();
                showToast(`Welcome, ${user.name}!`);
                closeLogin();

                // Prefill checkout fields for convenience
                prefillCheckoutWithUser();

                if (window.__postLoginCallback) {
                    const cb = window.__postLoginCallback; window.__postLoginCallback = null; cb();
                }
            }
        });

        function logout() {
            localStorage.removeItem('brewluxeUser');
            updateUserBadge();
            showToast('You have been signed out');
        }

        function updateUserBadge() {
            const container = document.getElementById('userBadge');
            if (!container) return;
            container.innerHTML = '';
            const user = getLoggedInUser();
            if (user) {
                const nameEl = document.createElement('div');
                nameEl.textContent = `Hi, ${user.name}`;
                nameEl.style.color = 'var(--gold)';
                nameEl.style.fontWeight = '600';
                const outBtn = document.createElement('button');
                outBtn.className = 'icon-btn';
                outBtn.title = 'Sign out';
                outBtn.textContent = '‚éã';
                outBtn.addEventListener('click', logout);
                container.appendChild(nameEl);
                container.appendChild(outBtn);
            } else {
                const inBtn = document.createElement('button');
                inBtn.className = 'icon-btn';
                inBtn.textContent = 'Sign in';
                inBtn.addEventListener('click', () => openLogin());
                container.appendChild(inBtn);
            }
        }

        function prefillCheckoutWithUser() {
            const user = getLoggedInUser();
            if (!user) return;
            const checkout = document.getElementById('checkoutModal');
            // If checkout modal exists, try to fill known fields
            const form = document.getElementById('checkoutForm');
            if (form) {
                const fullNameField = form.querySelector('input[name="fullName"]');
                const emailField = form.querySelector('input[name="email"]');
                if (fullNameField && !fullNameField.value) fullNameField.value = user.name || '';
                if (emailField && !emailField.value) emailField.value = user.email || '';
            }
        }

        // Typing indicator
        let typingTimeout = null;
        function showBotTyping() {
            const container = document.getElementById('chatMessages');
            const typing = document.createElement('div');
            typing.className = 'message bot typing';
            typing.id = 'botTyping';
            typing.textContent = '...';
            container.appendChild(typing);
            container.scrollTop = container.scrollHeight;
        }

        function hideBotTyping() {
            const el = document.getElementById('botTyping');
            if (el) el.remove();
        }

        // Suggested quick replies
        function renderSuggestedReplies(suggestions = []) {
            // remove existing suggestions
            const old = document.getElementById('chatSuggestions');
            if (old) old.remove();

            const container = document.createElement('div');
            container.id = 'chatSuggestions';
            container.style.padding = '0.5rem';
            container.style.display = 'flex';
            container.style.gap = '0.5rem';
            container.style.flexWrap = 'wrap';

            suggestions.forEach(s => {
                const btn = document.createElement('button');
                btn.className = 'icon-btn';
                btn.textContent = s.label;
                btn.style.padding = '0.5rem 0.75rem';
                btn.addEventListener('click', () => handleSuggestionClick(s));
                container.appendChild(btn);
            });

            const chatWindow = document.getElementById('chatWindow');
            chatWindow.querySelector('.chat-input-container').before(container);
        }

        function handleSuggestionClick(suggestion) {
            if (suggestion.action === 'send') {
                addUserMessage(suggestion.payload);
                setTimeout(() => {
                    showBotTyping();
                    setTimeout(() => {
                        hideBotTyping();
                        handleChatResponse(suggestion.payload.toLowerCase());
                    }, 700);
                }, 150);
            } else if (suggestion.action === 'addToCart') {
                addToCart(suggestion.payload.id, suggestion.payload.type);
            } else if (suggestion.action === 'openMenu') {
                scrollToSection('menu');
            }
        }

        function handleChatResponse(message) {
            showBotTyping();
            const replyLogic = () => {
                let response = '';

                if (message.includes('price') || message.includes('cost')) {
                    response = 'Our drinks range from $3.50 to $6.00. Coffee beans are $15.99 to $20.99. Check our menu for details!';
                } else if (message.includes('delivery') || message.includes('order') || message.includes('pickup')) {
                    response = 'We offer pickup and delivery! Orders are ready in 15-20 minutes. Delivery within 5 miles is $3.99.';
                } else if (message.includes('loyalty') || message.includes('points')) {
                    response = `You have ${loyaltyPoints} points! Earn 10% back on every purchase. Reach 750 points for Gold Member status!`;
                } else if (message.includes('location') || message.includes('hours')) {
                    response = 'We are open Mon-Fri 6AM-8PM, Sat-Sun 7AM-9PM. Visit us at 123 Coffee Street, Chennai!';
                } else if (message.includes('hello') || message.includes('hi')) {
                    response = 'Hello! Welcome to BREWLUXE! How can I help you today?';
                } else if (message.includes('menu') || message.includes('coffee') || message.includes('drinks')) {
                    response = 'We have a variety of coffee drinks including Espresso, Cappuccino, Latte, Mocha, and more! Check our menu section.';
                } else if (message.includes('status') || message.includes('order id') || message.includes('order')) {
                    response = 'To check an order status, provide your order id or go to Orders > Track Order.';
                } else {
                    response = 'I would be happy to help! Ask me about prices, delivery, loyalty points, or our location and hours.';
                }

                // Slight delay to simulate typing
                setTimeout(() => {
                    hideBotTyping();
                    addBotMessage(response);

                    // Build suggested replies (same as before)
                    const suggestions = [];

                    if (message.includes('menu') || message.includes('coffee') || message.includes('drinks')) {
                        suggestions.push({ label: 'Show Menu', action: 'openMenu' });
                        suggestions.push({ label: 'Popular: Caramel Latte', action: 'send', payload: 'Tell me about Caramel Latte' });
                    }

                    if (message.includes('buy') || message.includes('order') || message.includes('add')) {
                        const names = [...menuItems, ...products];
                        const found = names.find(it => message.includes(it.name.toLowerCase()));
                        if (found) {
                            suggestions.push({ label: `Add ${found.name} to Cart`, action: 'addToCart', payload: { id: found.id, type: menuItems.find(m=>m.id===found.id)?'menu':'product' } });
                        } else {
                            suggestions.push({ label: 'Add Caramel Latte', action: 'addToCart', payload: { id: 3, type: 'menu' } });
                            suggestions.push({ label: 'Add Ethiopian Blend', action: 'addToCart', payload: { id: 101, type: 'product' } });
                        }
                    }

                    suggestions.push({ label: 'Loyalty Points', action: 'send', payload: 'How many loyalty points do I have?' });
                    suggestions.push({ label: 'Delivery Info', action: 'send', payload: 'Do you deliver?' });

                    renderSuggestedReplies(suggestions);
                }, 600 + Math.random() * 600);
            };

            replyLogic();

            // Build context-aware suggested replies
            const suggestions = [];

            // If message mentions menu or coffee, suggest seeing the menu or specific items
            if (message.includes('menu') || message.includes('coffee') || message.includes('drinks')) {
                suggestions.push({ label: 'Show Menu', action: 'openMenu' });
                suggestions.push({ label: 'Popular: Caramel Latte', action: 'send', payload: 'Tell me about Caramel Latte' });
            }

            // If user asked about price or purchase, suggest quick add-to-cart actions for a top product
            if (message.includes('buy') || message.includes('order') || message.includes('add')) {
                // fuzzy match a product name from menu or products
                const names = [...menuItems, ...products];
                const found = names.find(it => message.includes(it.name.toLowerCase()));
                if (found) {
                    suggestions.push({ label: `Add ${found.name} to Cart`, action: 'addToCart', payload: { id: found.id, type: menuItems.find(m=>m.id===found.id)?'menu':'product' } });
                } else {
                    // suggest a couple of popular items
                    suggestions.push({ label: 'Add Caramel Latte', action: 'addToCart', payload: { id: 3, type: 'menu' } });
                    suggestions.push({ label: 'Add Ethiopian Blend', action: 'addToCart', payload: { id: 101, type: 'product' } });
                }
            }

            // Always provide quick help and loyalty info
            suggestions.push({ label: 'Loyalty Points', action: 'send', payload: 'How many loyalty points do I have?' });
            suggestions.push({ label: 'Delivery Info', action: 'send', payload: 'Do you deliver?' });

            renderSuggestedReplies(suggestions);
        }

        document.getElementById('searchBtn').addEventListener('click', openSearch);
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'k') {
                e.preventDefault();
                openSearch();
            }
            if (e.key === 'Escape') {
                closeSearch();
                closeNewsletter();
                closeCart();
                closeLightbox();
            }
        });

        function openSearch() {
            document.getElementById('searchModal').classList.add('active');
            document.getElementById('searchInput').focus();
        }

        function closeSearch() {
            document.getElementById('searchModal').classList.remove('active');
        }

        document.getElementById('searchInput').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const results = [...menuItems, ...products].filter(item => 
                item.name.toLowerCase().includes(query) || 
                item.description.toLowerCase().includes(query)
            );
            
            const resultsDiv = document.getElementById('searchResults');
            
            if (query.length === 0) {
                resultsDiv.innerHTML = '';
                return;
            }
            
            resultsDiv.innerHTML = `
                <p style="margin: 1rem 0; color: var(--gold);">Found ${results.length} results</p>
                ${results.map(item => `
                    <div style="padding: 1rem; background: var(--glass); margin: 0.5rem 0; border-radius: 10px; cursor: pointer;" onclick="closeSearch(); scrollToSection('${products.includes(item) ? 'products' : 'menu'}');">
                        <strong>${item.name}</strong> - ${item.price.toFixed(2)}
                        <br><small>${item.description}</small>
                    </div>
                `).join('')}
            `;
        });

        document.getElementById('contactForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const form = e.target;
            const isValid = validateContactForm(form);
            
            if (isValid) {
                showToast('‚úÖ Message sent successfully! We will get back to you soon.');
                form.reset();
                clearContactFormErrors(form);
            }
        });

        function closeNewsletter() {
            document.getElementById('newsletterModal').classList.remove('active');
        }

        document.getElementById('newsletterForm').addEventListener('submit', (e) => {
            e.preventDefault();
            addLoyaltyPoints(2);
            showToast('Subscribed! +20 loyalty points earned!');
            closeNewsletter();
            e.target.reset();
        });

        document.getElementById('notificationBtn').addEventListener('click', () => {
            openNotifications();
        });

        function renderNotifications() {
            const list = document.getElementById('notificationsList');
            if (!list) return;
            if (notifications.length === 0) {
                list.innerHTML = '<p style="color: rgba(255,255,255,0.7);">No notifications</p>';
                return;
            }
            list.innerHTML = notifications.map(n => `
                <div style="padding: 0.75rem; border-bottom: 1px solid rgba(255,255,255,0.03);">
                    <strong style="color: var(--gold);">${escapeHtml(n.title)}</strong>
                    <div style="color: rgba(255,255,255,0.85); margin-top: 0.25rem;">${escapeHtml(n.text)}</div>
                    <div style="font-size: 0.8rem; color: rgba(255,255,255,0.6); margin-top: 0.25rem;">${formatTime(new Date(n.time))}</div>
                </div>
            `).join('');
        }

        function openNotifications() {
            renderNotifications();
            document.getElementById('notificationsModal').classList.add('active');
            // mark as seen
            notifications.forEach(n => n.seen = true);
            updateNotificationBadge();
        }

        function closeNotifications() {
            document.getElementById('notificationsModal').classList.remove('active');
        }

        function clearNotifications() {
            notifications.length = 0;
            renderNotifications();
            updateNotificationBadge();
            closeNotifications();
            showToast('Notifications cleared');
        }

        function updateNotificationBadge() {
            const badge = document.getElementById('notifBadge');
            const unseen = notifications.filter(n => !n.seen).length;
            badge.textContent = unseen > 0 ? String(unseen) : '0';
            badge.style.display = unseen > 0 ? 'inline-block' : 'none';
        }

        document.getElementById('cartBtn').addEventListener('click', openCart);

        function openCart() {
            document.getElementById('cartModal').classList.add('active');
            renderCart();
        }

        function closeCart() {
            document.getElementById('cartModal').classList.remove('active');
        }

        function renderCart() {
            const container = document.getElementById('cartModalContent');
            
            if (cart.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 2rem; color: rgba(255,255,255,0.6);">Your cart is empty</p>';
                document.getElementById('cartTotal').textContent = '0.00';
                return;
            }
            
            container.innerHTML = cart.map((item, index) => `
                <div class="cart-item">
                    <div class="cart-item-info">
                        <h4>${item.name}</h4>
                        <p style="color: rgba(255,255,255,0.6);">${item.price.toFixed(2)} each</p>
                    </div>
                    <div class="cart-item-controls">
                        <button class="qty-btn" onclick="updateQuantity(${index}, -1)">-</button>
                        <span style="color: var(--gold); font-weight: 600;">${item.quantity}</span>
                        <button class="qty-btn" onclick="updateQuantity(${index}, 1)">+</button>
                        <button class="icon-btn-small" onclick="removeFromCart(${index})" style="margin-left: 0.5rem;">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('cartTotal').textContent = total.toFixed(2);
        }

        function updateQuantity(index, change) {
            cart[index].quantity += change;
            
            if (cart[index].quantity <= 0) {
                cart.splice(index, 1);
            }
            
            updateCartBadge();
            renderCart();
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartBadge();
            renderCart();
            showToast('Item removed from cart');
        }

        function checkout() {
            if (cart.length === 0) {
                showToast('Your cart is empty!');
                return;
            }
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const itemCount = cart.reduce((sum, item) => sum + item.quantity, 0);
            
            showToast(`Order placed! ${itemCount} items, Total: ${total.toFixed(2)}. Thank you!`);
            
            addLoyaltyPoints(total * 0.1);
            
            cart = [];
            updateCartBadge();
            closeCart();
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `<span style="font-size: 24px;">‚ú®</span><span>${message}</span>`;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3500);
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // Improved Checkout Functions
        let currentOrderType = 'pickup';

        function proceedToCheckout() {
            if (cart.length === 0) {
                showToast('‚ùå Your cart is empty!');
                return;
            }

            // Require login before allowing to proceed to checkout
            if (!isLoggedIn()) {
                openLogin(function() {
                    // after successful login, continue to checkout
                    closeCart();
                    document.getElementById('checkoutModal').classList.add('active');
                    renderCheckoutItems();
                    prefillCheckoutWithUser();
                    setOrderType('pickup');
                });
                return;
            }

            // user already logged in
            closeCart();
            document.getElementById('checkoutModal').classList.add('active');
            renderCheckoutItems();
            prefillCheckoutWithUser();
            setOrderType('pickup');
        }

        function setOrderType(type) {
            currentOrderType = type;
            
            document.getElementById('pickupBtn').classList.toggle('active', type === 'pickup');
            document.getElementById('deliveryBtn').classList.toggle('active', type === 'delivery');
            
            document.getElementById('deliveryFields').style.display = type === 'delivery' ? 'block' : 'none';
            document.getElementById('deliveryFeeRow').style.display = type === 'delivery' ? 'flex' : 'none';
            
            updateCheckoutTotal();
        }

        function renderCheckoutItems() {
            const container = document.getElementById('checkoutItemsList');
            
            container.innerHTML = cart.map(item => `
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>${item.name} x${item.quantity}</span>
                    <span>$${(item.price * item.quantity).toFixed(2)}</span>
                </div>
            `).join('');
            
            updateCheckoutTotal();
        }

        function updateCheckoutTotal() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const deliveryFee = currentOrderType === 'delivery' ? 3.99 : 0;
            const total = subtotal + deliveryFee;
            
            document.getElementById('checkoutSubtotal').textContent = subtotal.toFixed(2);
            document.getElementById('checkoutTotal').textContent = total.toFixed(2);
        }

        function validateCheckoutForm(form) {
            const fullName = form.querySelector('input[name="fullName"]').value.trim();
            const email = form.querySelector('input[name="email"]').value.trim();
            const phone = form.querySelector('input[name="phone"]').value.trim();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (!fullName || fullName.length < 2) {
                showToast('‚ùå Please enter a valid full name');
                return false;
            }
            if (!email || !emailRegex.test(email)) {
                showToast('‚ùå Please enter a valid email');
                return false;
            }
            if (!phone || phone.length < 10) {
                showToast('‚ùå Please enter a valid phone number');
                return false;
            }
            if (currentOrderType === 'delivery') {
                const address = form.querySelector('input[name="address"]').value.trim();
                const city = form.querySelector('input[name="city"]').value.trim();
                const postalCode = form.querySelector('input[name="postalCode"]').value.trim();
                
                if (!address || !city || !postalCode) {
                    showToast('‚ùå Please fill in all delivery address fields');
                    return false;
                }
            }
            
            return true;
        }

        function closeCheckout() {
            document.getElementById('checkoutModal').classList.remove('active');
            document.getElementById('checkoutContent').style.display = 'block';
            document.getElementById('orderConfirmation').style.display = 'none';
        }

        // Submit checkout form to backend orders API
        async function submitCheckoutForm(e) {
            if (e && e.preventDefault) e.preventDefault();
            const form = document.getElementById('checkoutForm');
            if (!form) return showToast('Checkout form not found');

            if (!validateCheckoutForm(form)) return;

            const fullName = form.querySelector('input[name="fullName"]').value.trim();
            const email = form.querySelector('input[name="email"]').value.trim();
            const phone = form.querySelector('input[name="phone"]').value.trim();
            const address = form.querySelector('input[name="address"]') ? form.querySelector('input[name="address"]').value.trim() : '';

            const orderPayload = {
                user: getLoggedInUser(),
                items: cart,
                total: document.getElementById('checkoutTotal').textContent || '0.00',
                orderType: currentOrderType,
                customer: { fullName, email, phone, address }
            };

            // Try to send to local backend; if unavailable, fall back to simulated confirmation
            try {
                const resp = await fetch('http://localhost:3000/api/orders', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderPayload)
                });

                if (!resp.ok) throw new Error('Network response was not ok');

                const data = await resp.json();
                if (data && data.ok) {
                    const orderId = data.id;
                    const eta = data.etaMinutes || Math.floor(Math.random() * 20) + 10;

                    // Show order confirmation with tracking
                    showOrderConfirmation(orderId, eta);
                    
                    cart = [];
                    updateCartBadge();
                    showToast('Order confirmed! üéâ');
                    addLoyaltyPoints(parseFloat(orderPayload.total || 0) * 0.1);

                    // Start polling for order status updates
                    pollOrderStatus(orderId, eta);
                } else {
                    throw new Error('Invalid response');
                }
            } catch (err) {
                // fallback: simulate confirmation when backend not running
                console.warn('Order submission failed, simulating confirmation:', err);
                const orderId = 'sim-' + Date.now();
                const eta = Math.floor(Math.random() * 20) + 12;

                showOrderConfirmation(orderId, eta);

                cart = [];
                updateCartBadge();
                showToast('Order placed locally (backend offline).');
                addLoyaltyPoints(parseFloat(orderPayload.total || 0) * 0.1);

                // Simulate order status for local demo
                simulateOrderTracking(orderId, eta);
            }
        }

        // Order tracking functions
        let trackingIntervals = new Map();

        function showOrderConfirmation(orderId, eta) {
            document.getElementById('orderNumber').textContent = orderId;
            document.getElementById('estimatedTime').textContent = eta + ' mins';
            document.getElementById('orderStatus').textContent = 'Received';
            document.getElementById('trackingProgress').style.width = '10%';

            document.getElementById('checkoutContent').style.display = 'none';
            document.getElementById('orderConfirmation').style.display = 'block';
        }

        function viewFullTracking() {
            const orderId = document.getElementById('orderNumber').textContent;
            if (!orderId) {
                showToast('No active order');
                return;
            }

            document.getElementById('trackingOrderId').textContent = orderId;
            document.getElementById('orderTrackingModal').classList.add('active');

            // Load current status
            updateTrackingDisplay(orderId);
        }

        function closeOrderTracking() {
            document.getElementById('orderTrackingModal').classList.remove('active');
        }

        async function pollOrderStatus(orderId, eta) {
            // Stop any existing polling for this order
            if (trackingIntervals.has(orderId)) {
                clearInterval(trackingIntervals.get(orderId));
            }

            let elapsedMins = 0;
            const interval = setInterval(async () => {
                elapsedMins++;
                
                try {
                    const resp = await fetch(`http://localhost:3000/api/orders/${orderId}`);
                    if (resp.ok) {
                        const data = await resp.json();
                        if (data.ok && data.order) {
                            updateTrackingUI(data.order, eta);
                        }
                    }
                } catch (err) {
                    console.warn('Failed to poll order status:', err);
                }

                // Stop polling after order is complete or 45 mins
                if (elapsedMins > 45) {
                    clearInterval(interval);
                    trackingIntervals.delete(orderId);
                }
            }, 5000); // Poll every 5 seconds

            trackingIntervals.set(orderId, interval);
        }

        function simulateOrderTracking(orderId, eta) {
            // Simulate order progression for local demo
            const stages = ['received', 'preparing', 'quality_check', 'ready'];
            let stageIndex = 0;
            
            const interval = setInterval(() => {
                if (stageIndex < stages.length) {
                    const status = stages[stageIndex];
                    const progress = ((stageIndex + 1) / stages.length) * 100;
                    
                    updateTrackingUI({
                        id: orderId,
                        status,
                        etaMinutes: eta - Math.floor((stageIndex / stages.length) * eta)
                    }, eta);
                    
                    stageIndex++;
                } else {
                    clearInterval(interval);
                    trackingIntervals.delete(orderId);
                }
            }, 8000); // Update every 8 seconds for demo

            trackingIntervals.set(orderId, interval);
        }

        function updateTrackingUI(order, originalEta) {
            if (!order) return;

            const status = order.status || 'received';
            const statusMap = {
                'received': 'Order Received ‚úì',
                'preparing': 'Being Prepared üë®‚Äçüç≥',
                'quality_check': 'Quality Check ‚úîÔ∏è',
                'ready': 'Ready for Pickup üéâ'
            };

            // Update confirmation card if visible
            const confirmEl = document.getElementById('orderConfirmation');
            if (confirmEl && confirmEl.style.display !== 'none') {
                document.getElementById('orderStatus').textContent = statusMap[status] || status;
                const progressMap = { 'received': 10, 'preparing': 40, 'quality_check': 70, 'ready': 100 };
                document.getElementById('trackingProgress').style.width = (progressMap[status] || 10) + '%';
            }

            // Update tracking modal if visible
            const trackingEl = document.getElementById('orderTrackingModal');
            if (trackingEl && trackingEl.classList.contains('active')) {
                updateTrackingDisplay(order.id, status, order.etaMinutes || originalEta);
            }
        }

        function updateTrackingDisplay(orderId, status = 'received', eta = 15) {
            const statusMap = {
                'received': 'Order Received ‚úì',
                'preparing': 'Being Prepared üë®‚Äçüç≥',
                'quality_check': 'Quality Check ‚úîÔ∏è',
                'ready': 'Ready for Pickup üéâ'
            };

            document.getElementById('trackingStatus').textContent = statusMap[status] || status;
            document.getElementById('trackingETA').textContent = `~${Math.max(1, eta)} mins`;

            // Update status icons
            const stages = ['received', 'preparing', 'quality_check', 'ready'];
            const currentIndex = stages.indexOf(status);

            document.getElementById('statusPrep').textContent = currentIndex >= 1 ? 'üë®‚Äçüç≥' : '‚è≥';
            document.getElementById('statusQuality').textContent = currentIndex >= 2 ? '‚úîÔ∏è' : '‚è≥';
            document.getElementById('statusReady').textContent = currentIndex >= 3 ? '‚úÖ' : '‚è≥';

            // Add update to log
            const updates = document.getElementById('trackingUpdates');
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const updateMsg = document.createElement('div');
            updateMsg.style.marginBottom = '0.5rem';
            updateMsg.style.color = 'rgba(255,255,255,0.7)';
            updateMsg.innerHTML = `<span style="color: var(--gold);">${time}</span> ‚Äî ${statusMap[status] || status}`;
            updates.insertBefore(updateMsg, updates.firstChild);

            // Keep only last 5 updates
            while (updates.children.length > 6) {
                updates.removeChild(updates.lastChild);
            }
        }

        function setupEventListeners() {
            window.addEventListener('scroll', () => {
                const nav = document.querySelector('nav');
                if (window.scrollY > 100) {
                    nav.style.background = 'rgba(15, 15, 15, 0.98)';
                    nav.style.boxShadow = '0 5px 30px rgba(201, 169, 110, 0.2)';
                } else {
                    nav.style.background = 'rgba(15, 15, 15, 0.95)';
                    nav.style.boxShadow = '0 2px 20px rgba(201, 169, 110, 0.1)';
                }
            });

            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal') && !e.target.classList.contains('modal-content')) {
                    closeSearch();
                    closeNewsletter();
                    closeCart();
                }
                
                if (e.target.id === 'lightbox') {
                    closeLightbox();
                }
            });
        }

        // Form Validation Functions
        function validateContactForm(form) {
            clearContactFormErrors(form);
            
            const name = form.querySelector('input[name="name"]').value.trim();
            const email = form.querySelector('input[name="email"]').value.trim();
            const message = form.querySelector('textarea[name="message"]').value.trim();
            const phone = form.querySelector('input[name="phone"]').value.trim();
            
            let isValid = true;
            
            // Name validation
            if (!name || name.length < 2) {
                markFormError(form, 'input[name="name"]', 'Name must be at least 2 characters');
                isValid = false;
            }
            
            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!email || !emailRegex.test(email)) {
                markFormError(form, 'input[name="email"]', 'Please enter a valid email');
                isValid = false;
            }
            
            // Phone validation (if provided)
            if (phone && phone.length < 10) {
                markFormError(form, 'input[name="phone"]', 'Phone must be at least 10 digits');
                isValid = false;
            }
            
            // Message validation
            if (!message || message.length < 10) {
                markFormError(form, 'textarea[name="message"]', 'Message must be at least 10 characters');
                isValid = false;
            }
            
            return isValid;
        }

        function markFormError(form, selector, errorMsg) {
            const field = form.querySelector(selector);
            if (field) {
                const group = field.closest('.form-group');
                group.classList.add('error');
                const errorSpan = group.querySelector('.form-error');
                if (errorSpan) {
                    errorSpan.textContent = errorMsg;
                }
            }
        }

        function clearContactFormErrors(form) {
            form.querySelectorAll('.form-group').forEach(group => {
                group.classList.remove('error');
            });
        }

        // Mobile navigation toggle behavior
        (function() {
            const navToggle = document.getElementById('navToggle');
            const navLinks = document.querySelector('.nav-links');

            if (navToggle && navLinks) {
                navToggle.setAttribute('aria-expanded', 'false');

                navToggle.addEventListener('click', () => {
                    const isOpen = navLinks.classList.toggle('open');
                    navToggle.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
                });

                // Close mobile nav when a link is selected
                navLinks.querySelectorAll('a').forEach(a => a.addEventListener('click', () => {
                    navLinks.classList.remove('open');
                    navToggle.setAttribute('aria-expanded', 'false');
                }));

                // Ensure nav closes when viewport becomes large again
                window.addEventListener('resize', () => {
                    if (window.innerWidth > 900) {
                        navLinks.classList.remove('open');
                        navToggle.setAttribute('aria-expanded', 'false');
                    }
                });
            }
        })();
    </script>
</body>
</html>